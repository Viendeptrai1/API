<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Product Management API - Phan Qu·ªëc Vi·ªÖn (MSSV: 23110362)</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body { 
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
		}
		
		.container {
			max-width: 1200px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			box-shadow: 0 20px 40px rgba(0,0,0,0.1);
			overflow: hidden;
		}
		
		.header {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			padding: 30px;
			text-align: center;
			color: white;
		}
		
		.header h1 {
			font-size: 2.5em;
			margin-bottom: 10px;
			text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
		}
		
		.developer-info {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 15px;
			margin-top: 15px;
		}
		
		.avatar {
			width: 60px;
			height: 60px;
			border-radius: 50%;
			border: 3px solid white;
			box-shadow: 0 4px 8px rgba(0,0,0,0.2);
		}
		
		.developer-text {
			font-size: 1.1em;
			font-weight: 500;
		}
		
		.content {
			padding: 40px;
		}
		
		section { 
			margin-bottom: 50px;
			background: #f8f9fa;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 5px 15px rgba(0,0,0,0.08);
		}
		
		section h2 {
			color: #2c3e50;
			margin-bottom: 25px;
			font-size: 1.8em;
			border-bottom: 3px solid #4facfe;
			padding-bottom: 10px;
		}
		
		.form-group {
			margin-bottom: 20px;
		}
		
		.form-row {
			display: flex;
			gap: 15px;
			flex-wrap: wrap;
			margin-bottom: 20px;
		}
		
		.form-row input, .form-row select {
			flex: 1;
			min-width: 200px;
		}
		
		input, select, textarea {
			padding: 12px 15px;
			border: 2px solid #e1e8ed;
			border-radius: 10px;
			font-size: 14px;
			transition: all 0.3s ease;
			background: white;
		}
		
		input:focus, select:focus, textarea:focus {
			outline: none;
			border-color: #4facfe;
			box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
		}
		
		textarea {
			width: 100%;
			min-height: 100px;
			resize: vertical;
		}
		
		button {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			color: white;
			border: none;
			padding: 12px 25px;
			border-radius: 25px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 600;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
		}
		
		button:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
		}
		
		button:active {
			transform: translateY(0);
		}
		
		.btn-danger {
			background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
			box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
		}
		
		.btn-danger:hover {
			box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
		}
		
		.btn-success {
			background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
			box-shadow: 0 4px 15px rgba(81, 207, 102, 0.3);
		}
		
		.btn-success:hover {
			box-shadow: 0 6px 20px rgba(81, 207, 102, 0.4);
		}
		
		table { 
			border-collapse: collapse; 
			width: 100%; 
			margin-top: 20px;
			background: white;
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 5px 15px rgba(0,0,0,0.08);
		}
		
		.empty-state {
			text-align: center;
			padding: 40px;
			color: #6c757d;
			font-style: italic;
		}
		
		th, td { 
			padding: 15px 12px; 
			text-align: left;
		}
		
		th { 
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			font-weight: 600;
			text-transform: uppercase;
			font-size: 12px;
			letter-spacing: 1px;
		}
		
		td {
			border-bottom: 1px solid #f1f3f4;
		}
		
		tr:hover {
			background: #f8f9fa;
		}
		
		tr:last-child td {
			border-bottom: none;
		}
		
		.actions {
			display: flex;
			gap: 8px;
		}
		
		.actions button {
			padding: 8px 15px;
			font-size: 12px;
		}
		
		.reload-btn {
			background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
			color: #2c3e50;
			margin-bottom: 20px;
		}
		
		.reload-btn:hover {
			box-shadow: 0 6px 20px rgba(168, 237, 234, 0.4);
		}
		
		@media (max-width: 768px) {
			.form-row {
				flex-direction: column;
			}
			
			.form-row input, .form-row select {
				min-width: 100%;
			}
			
			.developer-info {
				flex-direction: column;
				text-align: center;
			}
			
			.header h1 {
				font-size: 2em;
			}
			
			.content {
				padding: 20px;
			}
			
			section {
				padding: 20px;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h1>Product Management API</h1>
			<div class="developer-info">
				<img src="/image/avatar.jpg" alt="Avatar" class="avatar">
				<div class="developer-text">
					<strong>Developer:</strong> Phan Qu·ªëc Vi·ªÖn<br>
					<strong>MSSV:</strong> 23110362
				</div>
			</div>
		</div>
		
		<div class="content">
			<section>
				<h2>Category</h2>
				<button id="reloadCategory" class="reload-btn">üîÑ T·∫£i l·∫°i danh m·ª•c</button>
				<form id="categoryForm">
					<input type="hidden" id="categoryId">
					<div class="form-row">
						<input placeholder="T√™n danh m·ª•c" id="categoryName" required>
						<input type="file" id="categoryIcon" accept="image/*">
					</div>
					<button type="submit" class="btn-success">üíæ L∆∞u danh m·ª•c</button>
				</form>
		<table id="categoryTable">
			<thead><tr><th>ID</th><th>Name</th><th>Icon</th><th>Action</th></tr></thead>
			<tbody></tbody>
		</table>
	</section>

			<section>
				<h2>Product</h2>
				<button id="reloadProduct" class="reload-btn">üîÑ T·∫£i l·∫°i s·∫£n ph·∫©m</button>
				<form id="productForm">
					<input type="hidden" id="productId">
					<div class="form-row">
						<input placeholder="T√™n s·∫£n ph·∫©m" id="productName" required>
						<input placeholder="S·ªë l∆∞·ª£ng" type="number" id="quantity" value="1" min="0" required>
					</div>
					<div class="form-row">
						<input placeholder="Gi√° s·∫£n ph·∫©m" type="number" step="0.01" id="unitPrice" value="0" min="0" required>
						<input placeholder="Gi·∫£m gi√° (%)" type="number" step="0.01" id="discount" value="0" min="0" max="100">
					</div>
					<div class="form-row">
						<select id="productCategory" required>
							<option value="">Ch·ªçn danh m·ª•c</option>
						</select>
						<input placeholder="Tr·∫°ng th√°i" type="number" id="status" value="1" min="0" max="1">
					</div>
					<div class="form-group">
						<input type="file" id="productImages" accept="image/*">
					</div>
					<div class="form-group">
						<textarea placeholder="M√¥ t·∫£ s·∫£n ph·∫©m" id="description"></textarea>
					</div>
					<button type="submit" class="btn-success">üíæ L∆∞u s·∫£n ph·∫©m</button>
				</form>
		<table id="productTable">
			<thead><tr><th>ID</th><th>Name</th><th>Price</th><th>Category</th><th>Image</th><th>Action</th></tr></thead>
			<tbody></tbody>
		</table>
	</section>

	<script>
	async function fetchJSON(url) {
		const res = await fetch(url);
		return res.json();
	}
	function apiBody(ok, data) { return data.body ?? data; }

	async function loadCategories() {
		const data = await fetchJSON('/api/category');
		const items = apiBody(true, data);
		const tbody = document.querySelector('#categoryTable tbody');
		tbody.innerHTML = '';
		const select = document.getElementById('productCategory');
		select.innerHTML = '<option value="">Ch·ªçn danh m·ª•c</option>';
		
		if (items.length === 0) {
			tbody.innerHTML = '<tr><td colspan="4" class="empty-state">üìÇ Ch∆∞a c√≥ danh m·ª•c n√†o</td></tr>';
		} else {
			items.forEach(c => {
				const tr = document.createElement('tr');
				tr.innerHTML = `<td>${c.categoryId}</td><td>${c.categoryName}</td><td>${c.icon||''}</td>
				<td><div class="actions"><button data-id="${c.categoryId}" class="edit-cat">‚úèÔ∏è S·ª≠a</button> <button data-id="${c.categoryId}" class="del-cat btn-danger">üóëÔ∏è X√≥a</button></div></td>`;
				tbody.appendChild(tr);
				const opt = document.createElement('option');
				opt.value = c.categoryId; opt.textContent = c.categoryName; select.appendChild(opt);
			});
		}
	}

	async function loadProducts() {
		const data = await fetchJSON('/api/product');
		const items = apiBody(true, data);
		const tbody = document.querySelector('#productTable tbody');
		tbody.innerHTML = '';
		
		if (items.length === 0) {
			tbody.innerHTML = '<tr><td colspan="6" class="empty-state">üì¶ Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</td></tr>';
		} else {
			items.forEach(p => {
				const tr = document.createElement('tr');
				tr.innerHTML = `<td>${p.productId}</td><td>${p.productName}</td><td>${p.unitPrice.toLocaleString('vi-VN')} VNƒê</td><td>${p.category? p.category.categoryName: ''}</td><td>${p.images||''}</td>
				<td><div class="actions"><button data-id="${p.productId}" class="edit-pro">‚úèÔ∏è S·ª≠a</button> <button data-id="${p.productId}" class="del-pro btn-danger">üóëÔ∏è X√≥a</button></div></td>`;
				tbody.appendChild(tr);
			});
		}
	}

	document.getElementById('reloadCategory').onclick = loadCategories;
	document.getElementById('reloadProduct').onclick = loadProducts;

	document.getElementById('categoryForm').onsubmit = async (e) => {
		e.preventDefault();
		const id = document.getElementById('categoryId').value;
		const name = document.getElementById('categoryName').value;
		const icon = document.getElementById('categoryIcon').files[0];
		
		if (!name.trim()) {
			alert('Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!');
			return;
		}
		
		const fd = new FormData();
		if (id) fd.append('categoryId', id);
		fd.append('categoryName', name);
		if (icon) fd.append('icon', icon);
		const url = id ? '/api/category/updateCategory' : '/api/category/addCategory';
		
		try {
			await fetch(url, { method: id ? 'PUT':'POST', body: fd });
			document.getElementById('categoryForm').reset();
			loadCategories();
		} catch (error) {
			alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
		}
	};

	document.addEventListener('click', async (e) => {
		if (e.target.classList.contains('del-cat')) {
			const id = e.target.getAttribute('data-id');
			const params = new URLSearchParams({ categoryId: id });
			await fetch('/api/category/deleteCategory?' + params.toString(), { method: 'DELETE' });
			loadCategories();
		}
		if (e.target.classList.contains('edit-cat')) {
			const id = e.target.getAttribute('data-id');
			document.getElementById('categoryId').value = id;
			const data = await (await fetch('/api/category/getCategory?id=' + id)).json();
			const c = apiBody(true, data);
			document.getElementById('categoryName').value = c.categoryName;
		}
		if (e.target.classList.contains('del-pro')) {
			const id = e.target.getAttribute('data-id');
			const params = new URLSearchParams({ productId: id });
			await fetch('/api/product/deleteProduct?' + params.toString(), { method: 'DELETE' });
			loadProducts();
		}
		if (e.target.classList.contains('edit-pro')) {
			const id = e.target.getAttribute('data-id');
			document.getElementById('productId').value = id;
			const data = await (await fetch('/api/product/getProduct?id=' + id)).json();
			const p = apiBody(true, data);
			document.getElementById('productName').value = p.productName;
			document.getElementById('quantity').value = p.quantity;
			document.getElementById('unitPrice').value = p.unitPrice;
			document.getElementById('discount').value = p.discount;
			document.getElementById('status').value = p.status;
			document.getElementById('productCategory').value = p.category?.categoryId || '';
			document.getElementById('description').value = p.description || '';
		}
	});

	document.getElementById('productForm').onsubmit = async (e) => {
		e.preventDefault();
		const id = document.getElementById('productId').value;
		const productName = document.getElementById('productName').value;
		const quantity = document.getElementById('quantity').value;
		const unitPrice = document.getElementById('unitPrice').value;
		const categoryId = document.getElementById('productCategory').value;
		
		if (!productName.trim()) {
			alert('Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!');
			return;
		}
		if (!quantity || quantity < 0) {
			alert('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h·ª£p l·ªá!');
			return;
		}
		if (!unitPrice || unitPrice < 0) {
			alert('Vui l√≤ng nh·∫≠p gi√° s·∫£n ph·∫©m h·ª£p l·ªá!');
			return;
		}
		if (!categoryId) {
			alert('Vui l√≤ng ch·ªçn danh m·ª•c!');
			return;
		}
		
		const fd = new FormData();
		if (id) fd.append('productId', id);
		fd.append('productName', productName);
		fd.append('quantity', quantity);
		fd.append('unitPrice', unitPrice);
		fd.append('discount', document.getElementById('discount').value);
		fd.append('status', document.getElementById('status').value);
		fd.append('categoryId', categoryId);
		const img = document.getElementById('productImages').files[0];
		if (img) fd.append('images', img);
		const desc = document.getElementById('description').value;
		if (desc) fd.append('description', desc);
		const url = id ? '/api/product/updateProduct' : '/api/product/addProduct';
		
		try {
			await fetch(url, { method: id ? 'PUT':'POST', body: fd });
			document.getElementById('productForm').reset();
			loadProducts();
		} catch (error) {
			alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
		}
	};

			loadCategories();
			loadProducts();
		</script>
		</div>
	</div>
</body>
</html>
